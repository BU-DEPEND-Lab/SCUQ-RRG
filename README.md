# SCUQ-RRG
Code implementation for the paper "Semantic Consistency-Based Uncertainty Quantification for Factuality in Radiology Report Generation"

# Features
- Works on the API access to the model and UQ can be calculated with generated and sampled reports.
- Sentence-Level and Report-Level Uncertainty Quantification: Provides fine-grained uncertainty scores.
- Factual Consistency Evaluation: Helps filter out high-uncertainty sentences to improve clinical correctness.
- Radgraph based sentence-level factual score.


# Demo
We provide five examples demonstrating our GREEN-based report-level uncertainty and RadGraph-based sentence-level uncertainty. For more details, see [uq_report](./example/VRO_GREEN_demo.ipynb) and [uq_sentence](./example/VRO_Rad_demo.ipynb)for detail.
# Dataset Preparation
We follow the setup as https://github.com/ChantalMP/RaDialog for MIMIX-CXR dataset and will use generated rerports from ```checkpoints/vicuna-7b-img-report/checkpoint-11200``` checkpoint for our main experiment. 

We also showcase example data format in [example_data](./example/example_data.ipynb)

# Report Generations
For all experiments, we use the default temperature value 1 and sample 10 responses condioned on the same images. We saved the result generated by vllm model checkpoint into pkl/csv format as shown in [example_data](./data/example_data.ipynb)


# Report Scores
We leverage https://github.com/rajpurkarlab/CXR-Report-Metric for RRG evaluation e.g. BLEU Score, BERT Score, Semb Score, RadGraph Score, RadCliQ-v0 and RadCliQ-v1.

# Uncertainty Quantification
We use predictive entropy, lengthnormalised predictive entropy and lexical similarity as UQ baseline, as detailed in [uncertainty](./src/uq).

# Abstention
For details on Sentence-Level and Report-Level abstention, refer to the [abstention](./src/abstention/README.md).

# Alignment
For details on Sentence-Level and Report-Level alignment, refer to the [alignment](./src/alignment/README.md).

# Hallucination
For details on hallucination detection, refer to the [hallucination](./src/hallucination/README.md).

# MISC
Refer to [misc](./src/misc) for rank calibration error calculation and radgraph-based sentence level facutal score generation.








